"Content"
"    DROP PROCEDURE IF EXISTS testlink.PR_SEL_RELAT_PRODUTIVIDADE;&#xD;&#xA;    CREATE PROCEDURE testlink.`PR_SEL_RELAT_PRODUTIVIDADE`(&#xD;&#xA;       idProjetoTestLink INT,&#xD;&#xA;       idPlanoTeste      INT,&#xD;&#xA;       DataReferencia    VARCHAR(10),&#xD;&#xA;       idProjetoMantis   INT)&#xD;&#xA;    BEGIN&#xD;&#xA;          DECLARE vDataReferencia   DATE;&#xD;&#xA;          DECLARE vIdQuery          char(36);&#xD;&#xA;    &#xD;&#xA;          /* Carrega os dias Testes na tabela Tempor?ria */&#xD;&#xA;          SELECT FN_SELECIONA_CASO_TESTES(idProjetoTestLink, idPlanoTeste)&#xD;&#xA;            INTO vIdQuery;&#xD;&#xA;    &#xD;&#xA;          SELECT DATE(DataReferencia)&#xD;&#xA;            INTO vDataReferencia;&#xD;&#xA;    &#xD;&#xA;    SELECT a.username,&#xD;&#xA;           a.realname,&#xD;&#xA;           sum(a.falha) falha,&#xD;&#xA;           sum(a.passou) passou,&#xD;&#xA;           SUM(a.bloqueado) bloqueado,&#xD;&#xA;           sum(a.EmExecucao) EmExecucao,&#xD;&#xA;           sum(a.DefeitosFechados) DefeitosFechados,&#xD;&#xA;           sum(a.DefeitosReabertos) DefeitosReabertos&#xD;&#xA;      FROM (SELECT X.LOGIN_TESTER username,&#xD;&#xA;                   X.NOME_TESTER realname,&#xD;&#xA;                   CASE STATUS WHEN 'f' THEN 1 ELSE 0 END Falha,&#xD;&#xA;                   CASE STATUS WHEN 'p' THEN 1 ELSE 0 END Passou,&#xD;&#xA;                   CASE STATUS WHEN 'b' THEN 1 ELSE 0 END Bloqueado,&#xD;&#xA;                   0 EmExecucao,&#xD;&#xA;                   0 DefeitosFechados,&#xD;&#xA;                   0 DefeitosReabertos&#xD;&#xA;              FROM testlink.tmp_result_report X&#xD;&#xA;             WHERE X.ID_QUERY = vIdQuery&#xD;&#xA;                   AND X.DATA_EXECUCAO = vDataReferencia&#xD;&#xA;            UNION ALL&#xD;&#xA;            SELECT X.LOGIN_TESTER username,&#xD;&#xA;                   X.NOME_TESTER realname,&#xD;&#xA;                   0 Falha,&#xD;&#xA;                   0 Passou,&#xD;&#xA;                   0 Bloqueado,&#xD;&#xA;                   CASE STATUS WHEN 'r' THEN 1 ELSE 0 END EmExecucao,&#xD;&#xA;                   0 DefeitosFechados,&#xD;&#xA;                   0 DefeitosReabertos&#xD;&#xA;              FROM testlink.tmp_result_report X&#xD;&#xA;             WHERE X.ID_QUERY = vIdQuery&#xD;&#xA;            UNION ALL&#xD;&#xA;            SELECT user.username,&#xD;&#xA;                   user.realname,&#xD;&#xA;                   0 Falha,&#xD;&#xA;                   0 Passou,&#xD;&#xA;                   0 Bloqueado,&#xD;&#xA;                   0 EmExecucao,&#xD;&#xA;                   CASE WHEN bug.resolution <> 30 THEN 1 ELSE 0 END&#xD;&#xA;                      DefeitosFechados,&#xD;&#xA;                   CASE WHEN bug.resolution = 30 THEN 1 ELSE 0 END&#xD;&#xA;                      DefeitosReabertos&#xD;&#xA;              FROM mantis.mantis_bug_table bug,&#xD;&#xA;                   mantis.mantis_category_table categ,&#xD;&#xA;                   mantis.mantis_user_table user&#xD;&#xA;             WHERE     bug.project_id = idProjetoMantis&#xD;&#xA;                   AND bug.category_id = categ.id&#xD;&#xA;                   AND bug.status = 90      -- Fechado&#xD;&#xA;                   AND bug.resolution <> 10 -- Aberto&#xD;&#xA;                   AND date(FROM_UNIXTIME(bug.last_updated)) = vDataReferencia&#xD;&#xA;                   AND bug.reporter_id = user.id) a&#xD;&#xA;      WHERE a.username IS NOT NULL&#xD;&#xA;    GROUP BY a.username;&#xD;&#xA;    END;"
